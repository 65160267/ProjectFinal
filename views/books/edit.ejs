<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: <%= book.title %></title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="header-inner container">
        <div class="brand">
          <a href="/dashboard" style="color: inherit; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='rgba(255,255,255,0.8)'" onmouseout="this.style.color='inherit'">
            SwapABook
          </a>
        </div>
        <nav class="header-actions">
          <a href="/dashboard" title="Home">üè†</a>
          <a href="/books" title="Cart">üõçÔ∏è</a>
          <a href="/messages" title="Messages">üí¨</a>
          <% if (typeof user !== 'undefined' && user && user.username) { %>
            <a href="/user" class="header-user" title="Your profile">
              <img class="user-avatar" 
                   src="<%= (user.avatar && user.avatar.startsWith('/')) ? user.avatar : (user.avatar ? '/uploads/' + user.avatar : '/images/profile-placeholder.svg') %>" 
                   alt="Profile" 
                   onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22150%22 height=%22150%22 viewBox=%220 0 150 150%22%3E%3Crect width=%22150%22 height=%22150%22 fill=%22%23f0f0f0%22/%3E%3Ccircle cx=%2275%22 cy=%2260%22 r=%2225%22 fill=%22%23ddd%22/%3E%3Cpath d=%22M30 130 Q30 100 50 100 L100 100 Q120 100 120 130 Z%22 fill=%22%23ddd%22/%3E%3C/svg%3E'" />
            </a>
            <a href="/auth/logout" title="Logout">üîì</a>
          <% } else { %>
            <a href="/auth/login" title="Login">üîì</a>
          <% } %>
        </nav>
      </div>
    </header>

    <main class="container">
      <div class="card book-card-form">
        <h1 class="form-title">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
        <form class="book-form" action="/books/<%= book.id %>/edit" method="post" enctype="multipart/form-data">
          <div class="form-grid">
            <div class="field">
              <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
              <input name="title" required placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠" value="<%= book.title %>" />
            </div>

            <div class="field">
              <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
              <input name="category" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢, ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤" value="<%= book.category %>" />
            </div>

            <div class="field">
              <label>‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡πà‡∏á‡∏Ç‡∏≠‡∏á</label>
              <select name="condition">
                <option value="new" <%= book.condition === 'new' ? 'selected' : '' %>>‡πÉ‡∏´‡∏°‡πà</option>
                <option value="good" <%= book.condition === 'good' ? 'selected' : '' %>>‡∏î‡∏µ</option>
                <option value="used" <%= book.condition === 'used' ? 'selected' : '' %>>‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
              </select>
            </div>

            <div class="field full">
              <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
              <textarea name="description" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏™‡∏†‡∏≤‡∏û‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"><%= book.description %></textarea>
            </div>

            <div class="field">
              <label>‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å‡∏Å‡∏±‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£</label>
              <input name="wanted" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å" value="<%= book.wanted %>" />
            </div>

            <div class="field">
              <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å</label>
              <input name="location" placeholder="‡πÄ‡∏°‡∏∑‡∏≠‡∏á/‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î" value="<%= book.location %>" />
            </div>

            <div class="field file-field">
              <label>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)</label>
              <input type="file" name="image" accept="image/*" />
              <% if (book.thumbnail) { %>
                <div style="margin-top: 8px; font-size: 12px; color: #777;">
                  ‡∏£‡∏π‡∏õ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:
                  <div style="margin-top:6px; width: 120px; height: 160px; border-radius: 8px; overflow: hidden; border:1px solid rgba(0,0,0,0.08);">
                    <img src="<%= book.thumbnail %>" alt="Current cover" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.style.display='none'" />
                  </div>
                </div>
              <% } %>
            </div>
          </div>

          <div class="form-actions">
            <button class="btn btn-primary" type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            <a class="btn btn-ghost" href="/books">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</a>
          </div>
        </form>
      </div>
    </main>
    <%- include('../partials/footer_unified') %>
    <%- include('../partials/report_footer') %>
  </body>
</html>
