<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Marketplace</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="header-inner container">
        <div class="brand">
          <a href="/dashboard" style="color: inherit; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='rgba(255,255,255,0.8)'" onmouseout="this.style.color='inherit'">
            Trade Web
          </a>
        </div>
        <nav class="top-nav">
          <a href="/marketplace">Marketplace</a>
          <a href="/books/new">Add Product</a>
          <a href="/auth/login">Live chat</a>
          <a href="/books">My List</a>
        </nav>
        <nav class="header-actions">
          <% if (typeof user !== 'undefined' && user && user.username) { %>
            <a href="/user" class="header-user" title="Your profile">
              <img class="user-avatar" src="<%= user.avatar || '/images/profile-placeholder.png' %>" alt="Profile" />
            </a>
            <a href="/auth/logout">Logout</a>
          <% } else { %>
            <a href="/auth/login">Login</a>
          <% } %>
        </nav>
      </div>
    </header>

    <main class="container marketplace-main">
      <aside class="market-sidebar card">
        <h3>Marketplace</h3>
        <ul style="list-style: none; padding: 0; margin: 0;">
          <li style="margin-bottom: 8px;">
            <a href="/dashboard" style="display: flex; align-items: center; gap: 10px; padding: 10px 12px; text-decoration: none; border-radius: 8px; font-weight: 600; color: var(--accent-700);">
              üè† <span>‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span>
            </a>
          </li>
          <li style="margin-bottom: 8px;">
            <a href="/books" style="display: flex; align-items: center; gap: 10px; padding: 10px 12px; text-decoration: none; border-radius: 8px; font-weight: 600; color: var(--muted);">
              üìö <span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</span>
            </a>
          </li>
          <li style="margin-bottom: 8px;">
              <a href="/books/new" style="display: flex; align-items: center; gap: 10px; padding: 10px 12px; text-decoration: none; border-radius: 8px; font-weight: 600; color: #667eea;">
                ‚ûï <span>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</span>
              </a>
            </li>
        </ul>
      </aside>

      <section class="market-content">
        <div class="card">
          <h2>Recently Posted</h2>
          <input class="search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." />
          <div class="product-grid">
            <% if (books && books.length) { %>
              <% books.forEach(b => { %>
                <div class="product-card">
                  <div class="product-thumb" data-thumb="<%= b.thumbnail || '/images/placeholder.png' %>"></div>
                  <div class="product-body">
                    <div class="product-title"><%= b.title || 'Product' %></div>
                    <div class="product-tags">‡πÅ‡∏•‡∏Å‡∏Å‡∏±‡∏ö: <span class="badge"><%= b.tags || 'n/a' %></span></div>
                    <div class="product-meta"><%= b.location || 'Unknown' %></div>
                  </div>
                </div>
              <% }) %>
            <% } else { %>
              <p class="muted">No products found.</p>
            <% } %>
          </div>
        </div>
      </section>
    </main>
    <script>
      document.querySelectorAll('.product-thumb[data-thumb]').forEach(el => {
        el.style.backgroundImage = `url(${el.getAttribute('data-thumb')})`;
      });
    </script>
    <%- include('partials/footer_unified') %>
    <%- include('partials/report_footer') %>
  </body>
</html>
