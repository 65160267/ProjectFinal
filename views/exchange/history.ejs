<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô - SwapABook</title>
    <link rel="stylesheet" href="/css/style.css" />
    <style>
      .history-container { max-width: 1000px; margin: 0 auto; padding: 20px; }
      .history-card { background: var(--card, #fff); border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); border: 1px solid var(--input-border, #e9ecef); }
      .history-row { display:flex; gap:12px; align-items:center; }
      .history-thumb { width:48px; height:60px; object-fit:cover; border-radius:6px; box-shadow: 0 1px 3px rgba(0,0,0,0.12); }
      .history-meta h4 { margin:0; color: var(--dark, #1f2937); font-size: 16px; }
      .muted { color: var(--muted, #6b7280); font-size:13px; }
      .tabs { 
        display: flex; 
        gap: 12px; 
        background: rgba(255,255,255,0.05); 
        padding: 6px; 
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      }
      .tab { 
        padding: 10px 20px; 
        border-radius: 8px; 
        text-decoration: none; 
        color: var(--muted, #6b7280); 
        background: transparent;
        font-size: 14px; 
        font-weight: 600;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 6px;
        border: 1px solid transparent;
      }
      .tab:hover { 
        background: rgba(255,255,255,0.1); 
        color: var(--dark, #1f2937);
        transform: translateY(-1px);
      }
      .tab.active { 
        background: linear-gradient(135deg, var(--accent, #ff7a59) 0%, var(--accent-600, #ff6347) 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(255,122,89,0.4);
        border-color: rgba(255,255,255,0.2);
      }
      .empty { padding:40px; text-align:center; color: var(--muted, #6b7280); }
      .warn { background:#fff3cd;border:1px solid #ffe8a1;padding:12px;border-radius:8px;margin-bottom:12px;color:#8a6d00 }
    </style>
  </head>
  <body>
    <header class="site-header">
      <div class="header-inner container">
        <div class="brand">
          <a href="/dashboard" style="color: inherit; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='rgba(255,255,255,0.8)'" onmouseout="this.style.color='inherit'">
            SwapABook
          </a>
        </div>
        <nav class="header-actions">
          <a href="/dashboard" title="‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å">üè†</a>
          <a href="/books" title="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠">üìö</a>
          <a href="/exchange/incoming" title="‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö">üì•</a>
          <a href="/exchange/outgoing" title="‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÑ‡∏õ">üì§</a>
          <a href="/exchange/history" title="‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥" style="background: rgba(255,255,255,0.1); border-radius: 6px; padding: 6px 10px;">üìú</a>
          <a href="/user" title="‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå">üë§</a>
          <a href="/auth/logout" title="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö">üîì</a>
        </nav>
      </div>
    </header>

    <main class="container">
      <div class="history-container">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;">
          <h1 style="margin:0;color:var(--dark, #1f2937)">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h1>
          <div class="tabs">
            <a class="tab" href="/exchange/incoming">üì• ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö</a>
            <a class="tab" href="/exchange/outgoing">üì§ ‡∏™‡πà‡∏á‡πÑ‡∏õ</a>
            <a class="tab active" href="/exchange/history">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</a>
          </div>
        </div>

        <% if (typeof warning !== 'undefined' && warning) { %>
          <div class="warn">‚ö†Ô∏è <%= warning %></div>
        <% } %>

        <% if (history && history.length > 0) { %>
          <% history.forEach(function(h) { %>
            <div class="history-card">
              <div class="history-row">
                <div style="flex:0 0 48px">
                  <img src="<%= h.book1_thumbnail %>" class="history-thumb" alt="book1" onerror="this.src='/images/profile-placeholder.svg'" />
                </div>
                <div style="flex:0 0 48px">
                  <img src="<%= h.book2_thumbnail %>" class="history-thumb" alt="book2" onerror="this.src='/images/profile-placeholder.svg'" />
                </div>
                <div style="flex:1" class="history-meta">
                  <h4><%= h.book1_title || '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠' %> ‚áÑ <%= h.book2_title || '‚Äî' %></h4>
                  <div class="muted">‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á <strong><%= h.user1_username %></strong> ‡πÅ‡∏•‡∏∞ <strong><%= h.user2_username %></strong></div>
                  <div class="muted">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <%= new Date(h.exchange_date).toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' }) %></div>
                </div>
              </div>
            </div>
          <% }); %>
        <% } else { %>
          <div class="empty">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</div>
        <% } %>
      </div>
    </main>
    <%- include('../partials/footer_unified') %>
    <%- include('../partials/report_footer') %>
  </body>
</html>