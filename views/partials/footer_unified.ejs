<footer class="site-footer">
  <div class="container">
    <!-- Single row: Branding, User chip, Copyright -->
    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px;margin-bottom:20px;">
      <!-- Left: Branding -->
      <div style="display:flex;gap:12px;align-items:center;flex:1;min-width:200px;">
        <div class="footer-brand-icon" style="width:48px;height:48px;border-radius:10px;display:flex;align-items:center;justify-content:center;color:#fff;background:linear-gradient(135deg, var(--accent), var(--accent-600));box-shadow:inset 0 1px 0 rgba(255,255,255,0.35), 0 6px 18px rgba(0,0,0,0.12);font-size:22px;">üìö</div>
        <div>
          <div style="font-weight:900;color:#fff;font-size:16px;">SwapABook</div>
          <div style="font-size:12px;color:rgba(255,255,255,0.9);">‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</div>
        </div>
      </div>

      <!-- Center: User chip (if logged in) -->
      <% if (typeof user !== 'undefined' && user && user.username) { %>
        <div style="display:flex;justify-content:center;flex:0 0 auto;">
          <div class="footer-chip" style="display:flex;align-items:center;gap:10px;padding:8px 16px;border-radius:20px;backdrop-filter:blur(10px);background:linear-gradient(135deg, var(--accent), var(--accent-600));color:#fff;border:1px solid rgba(255,255,255,0.35);box-shadow:0 8px 24px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.35);">
            <img src="<%= (user.avatar && user.avatar.startsWith('/')) ? user.avatar : (user.avatar ? '/uploads/' + user.avatar : '/images/profile-placeholder.svg') %>" alt="Profile" style="width:32px;height:32px;border-radius:50%;object-fit:cover;" onerror="this.src='/images/profile-placeholder.svg'" />
            <div>
              <div style="color:#fff;font-weight:700;font-size:13px;"><%= user.full_name || user.username %></div>
              <div style="color:rgba(255,255,255,0.85);font-size:11px;">üéØ ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‚Ä¢ <%= user.location || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà' %></div>
            </div>
            <a href="/user" style="background:rgba(255,255,255,0.2);color:#fff;padding:4px 6px;border-radius:4px;text-decoration:none;font-size:11px;">‚úèÔ∏è</a>
          </div>
        </div>
      <% } %>

      <!-- Right: Copyright -->
      <div style="text-align:right;flex:1;min-width:200px;">
        <div style="color:#fff;font-weight:700;font-size:13px;margin-bottom:2px;">¬© <%= new Date().getFullYear() %> SwapABook</div>
        <div style="color:rgba(255,255,255,0.85);font-size:11px;">By Weerapat Tapaothong</div>
      </div>
    </div>

    <!-- Bottom links -->
    <div style="margin-top:20px;padding-top:16px;border-top:1px solid rgba(255,255,255,0.25);">
      <div style="display:flex;justify-content:center;align-items:center;gap:24px;flex-wrap:wrap;">
        <a href="/dashboard" style="color:rgba(255,255,255,0.95);text-decoration:none;font-size:13px;display:flex;align-items:center;gap:6px;">üè† <span>‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</span></a>
        <a href="/books" style="color:rgba(255,255,255,0.95);text-decoration:none;font-size:13px;display:flex;align-items:center;gap:6px;">üìö <span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span></a>
        <% if (typeof user !== 'undefined' && user && user.id) { %>
          <a href="/books/new" style="color:rgba(255,255,255,0.95);text-decoration:none;font-size:13px;display:flex;align-items:center;gap:6px;">‚ûï <span>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</span></a>
        <% } %>
        <% const __onUserPage = (typeof currentPath !== 'undefined' && currentPath === '/user'); %>
        <a href="/user" style="color:rgba(255,255,255,0.95);text-decoration:none;font-size:13px;display:flex;align-items:center;gap:6px;">
          <% if (!__onUserPage) { %>üë§ <% } %><span>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</span>
        </a>
      </div>
    </div>

    <style>
      @media (max-width: 1024px) {
        .site-footer [style*="justify-content:space-between"] { 
          flex-direction: column; 
          text-align: center; 
          gap: 16px; 
        }
        .site-footer [style*="text-align:right"] { 
          text-align: center !important; 
        }
        .site-footer [style*="min-width:200px"] {
          min-width: auto !important;
        }
      }
      
      @media (max-width: 768px) {
        .site-footer .footer-chip {
          flex-direction: row;
          text-align: left;
        }
      }
    </style>
  </div>
</footer>

<script>
  // Expose minimal user info for global scripts (if available)
  try {
    <% if (typeof user !== 'undefined' && user && user.id) { %>
      window.__ME__ = {
        id: <%- JSON.stringify(user.id) %>,
        username: <%- JSON.stringify(user.username || '') %>
      };
    <% } %>
  } catch (e) {}
</script>
<!-- Socket.IO client (for notifications and real-time features) -->
<script src="/socket.io/socket.io.js"></script>
<!-- Global chat notification badge handler -->
<script src="/js/chat-notify.js"></script>
