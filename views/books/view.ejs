<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title><%= book.title %></title>
    <link rel="stylesheet" href="/css/style.css" />
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/chat.js"></script>
  </head>
  <body>
    <header class="site-header">
      <div class="header-inner container">
        <div class="brand">
          <a href="/dashboard" style="color: inherit; text-decoration: none; transition: color 0.2s;" onmouseover="this.style.color='rgba(255,255,255,0.8)'" onmouseout="this.style.color='inherit'">
            SwapABook
          </a>
        </div>
        <form class="search" action="/" method="get">
          <input name="q" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠" />
          <button type="submit">üîç</button>
        </form>
        <nav class="header-actions">
          <a href="/books">üõçÔ∏è</a>
          <a href="/books/new">‚ûï</a>
          <a href="/auth/logout">üîì</a>
        </nav>
      </div>
    </header>

    <main class="container">
      <div class="detail-wrap">
        <div class="detail-card">
          <div class="detail-inner">
            <div class="detail-media">
              <% /* show large image / thumbnail or placeholder */ %>
              <div class="detail-image" style="background-image: url('<%= book.thumbnail %>')"></div>
            </div>
            <div class="detail-info">
              <h2 class="detail-title"><%= book.title %></h2>

              <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ó‡πá‡∏Å‡∏™‡πå -->
              <div style="margin-top:10px">
                <strong>üè∑Ô∏è ‡πÅ‡∏ó‡πá‡∏Å:</strong> 
                <span class="badge" style="background: #f3e5f5; color: #7b1fa2;"><%= book.tags %></span>
              </div>

              <!-- ‡∏™‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
              <div style="margin-top:10px">
                <strong>‚≠ê ‡∏™‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</strong>
                <% if (book.condition === 'new') { %>
                  <span class="pill condition" style="padding: 4px 12px; border-radius: 20px; font-size: 13px; font-weight: 600; background: #e8f5e8; color: #2e7d32;"><%= book.conditionText %></span>
                <% } else if (book.condition === 'good') { %>
                  <span class="pill condition" style="padding: 4px 12px; border-radius: 20px; font-size: 13px; font-weight: 600; background: #fff3e0; color: #f57c00;"><%= book.conditionText %></span>
                <% } else { %>
                  <span class="pill condition" style="padding: 4px 12px; border-radius: 20px; font-size: 13px; font-weight: 600; background: #fce4ec; color: #c2185b;"><%= book.conditionText %></span>
                <% } %>
              </div>

              <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á -->
              <div style="margin-top:16px; padding-top:12px; border-top:1px solid #e5e5e5;">
                <h3 style="color: var(--muted); font-size: 14px; margin-bottom: 8px;">üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                <div style="background: #f8f9fa; padding: 10px; border-radius: 6px;">
                  <div style="margin-bottom: 6px;">
                    <strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> <%= book.ownerName %>
                  </div>
                  <div>
                    <strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> <%= book.ownerLocation %>
                  </div>
                </div>
              </div>

              <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏û‡∏™‡∏ï‡πå -->
              <div style="margin-top:12px; padding-top:12px; border-top:1px solid #e5e5e5;">
                <h3 style="color: var(--muted); font-size: 14px; margin-bottom: 8px;">üìÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÇ‡∏û‡∏™‡∏ï‡πå</h3>
                <div style="font-size: 13px; color: #666;">
                  <div style="margin-bottom: 4px;">
                    <strong>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</strong> #<%= book.id %>
                  </div>
                  <div style="margin-bottom: 4px;">
                    <strong>‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠:</strong> <%= book.createdDate %>
                  </div>
                  <% if (book.updatedDate) { %>
                    <div>
                      <strong>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</strong> <%= book.updatedDate %>
                    </div>
                  <% } %>
                </div>
              </div>

              <!-- ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î -->
              <div style="margin-top:20px; padding-top:16px; border-top:2px solid #f0f0f0;">
                <h3 style="color: var(--muted); font-size: 16px; margin-bottom: 8px;">üìù ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h3>
                <div class="description-box" style="background: #f8f9fa; padding: 12px; border-radius: 8px; line-height: 1.5; white-space: pre-wrap;">
                  <%= book.description %>
                </div>
              </div>

              <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô -->
              <div style="margin-top:20px; padding-top:16px; border-top:2px solid #f0f0f0;">
                <h3 style="color: var(--muted); font-size: 16px; margin-bottom: 12px;">üîÑ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</h3>
                
                <div style="background: #fafafa; padding: 12px; border-radius: 8px; margin-bottom: 12px;">
                  <div style="margin-bottom: 8px;">
                    <strong>üí´ ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å‡∏Å‡∏±‡∏ö:</strong> 
                    <span style="color: var(--accent-700); font-weight: 600;"><%= book.wanted %></span>
                  </div>
                  <div style="margin-bottom: 8px;">
                    <strong>üìç ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏Å:</strong> 
                    <span style="color: var(--accent-700);"><%= book.exchangeLocation %></span>
                  </div>
                  <div>
                    <strong>‚úÖ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong>
                    <span class="pill <%= book.isAvailable ? 'available' : 'unavailable' %>">
                      <%= book.availabilityText %>
                    </span>
                  </div>
                </div>

                <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏≠‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô -->
                <% if (book.isAvailable) { %>
                  <form method="post" action="/exchange/request/<%= book.id %>" style="margin-top: 16px;">
                    <div style="margin-bottom: 12px;">
                      <label for="message" style="color: var(--muted); font-weight: 600; font-size: 14px;">üí¨ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏∂‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á:</label>
                      <textarea id="message" name="message" rows="3" 
                                placeholder="‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡∏ö‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô..."
                                style="width: 100%; margin-top: 6px; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-family: inherit; resize: vertical;"></textarea>
                    </div>

                    <div style="margin-bottom: 16px;">
                      <label for="offeredBookId" style="color: var(--muted); font-weight: 600; font-size: 14px;">üìö ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡∏°‡∏≤‡πÅ‡∏•‡∏Å (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö):</label>
                      <select id="offeredBookId" name="offeredBookId" style="width: 100%; margin-top: 6px; padding: 8px; border: 1px solid #ddd; border-radius: 6px;">
                        <option value="">-- ‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏ô‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏â‡∏û‡∏≤‡∏∞ --</option>
                        <% if (typeof userBooks !== 'undefined' && userBooks && userBooks.length > 0) { %>
                          <% userBooks.forEach(function(userBook) { %>
                            <option value="<%= userBook.id %>">
                              <%= userBook.title %><% if (userBook.author) { %> - <%= userBook.author %><% } %>
                            </option>
                          <% }); %>
                        <% } %>
                      </select>
                      <small style="color: #666; font-size: 12px; margin-top: 4px; display: block;">
                        <% if (typeof userBooks !== 'undefined' && userBooks && userBooks.length > 0) { %>
                          ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏π‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏≠‡∏á
                        <% } else { %>
                          ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤<a href="/books/new" style="color: var(--accent);">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</a>‡∏Å‡πà‡∏≠‡∏ô
                        <% } %>
                      </small>
                    </div>

                    <div style="display: flex; gap: 8px;">
                      <button type="submit" class="btn btn-primary" style="flex: 1;">
                        ÔøΩ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
                      </button>
                      <button type="button" class="btn btn-ghost" onclick="window.history.back()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                    </div>
                  </form>
                <% } else { %>
                  <div class="alert" style="padding:12px; background:#ffe6e6; border:1px solid #ffcccc; border-radius:8px; color:#cc0000; margin-top: 12px;">
                    ‚ö†Ô∏è ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ
                  </div>
                  <button class="btn btn-ghost" style="margin-top:12px; width: 100%;" onclick="window.history.back()">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏î‡∏π‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏∑‡πà‡∏ô</button>
                <% } %>
              </div>
            </div>
          </div>

          <!-- chat removed per request -->
        </div>
      </div>
    </main>

    <footer class="site-footer">
      <div class="container footer-bottom">
        <div class="copyright">Swap A Book <%= new Date().getFullYear() %></div>
      </div>
    </footer>
  </body>
</html>
