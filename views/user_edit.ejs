<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Edit Profile</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="header-inner container">
        <div class="brand">
          <a href="/dashboard" class="brand">SwapABook</a>
        </div>
        <nav class="header-actions">
          <a href="/dashboard" title="Home">üè†</a>
          <a href="/books" title="Cart">üõçÔ∏è</a>
          <a href="/messages" title="Messages">üí¨</a>
          <% if (typeof user !== 'undefined' && user && user.username) { %>
            <a href="/user" class="header-user" title="Your profile">
              <img class="user-avatar" 
                   src="<%= (user.avatar && user.avatar.startsWith('/')) ? user.avatar : (user.avatar ? '/uploads/' + user.avatar : '/images/profile-placeholder.svg') %>" 
                   alt="Profile" 
                   onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22150%22 height=%22150%22 viewBox=%220 0 150 150%22%3E%3Crect width=%22150%22 height=%22150%22 fill=%22%23f0f0f0%22/%3E%3Ccircle cx=%2275%22 cy=%2260%22 r=%2225%22 fill=%22%23ddd%22/%3E%3Cpath d=%22M30 130 Q30 100 50 100 L100 100 Q120 100 120 130 Z%22 fill=%22%23ddd%22/%3E%3C/svg%3E'" />
            </a>
            <a href="/auth/logout" title="Logout">ÔøΩ</a>
          <% } else { %>
            <a href="/auth/login" title="Login">üîì</a>
          <% } %>
        </nav>
      </div>
    </header>

    <main class="container">
      <div class="card" style="max-width:720px;margin:24px auto;padding:18px">
        <h2>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</h2>
        <form action="/user/edit" method="post" enctype="multipart/form-data">
          <div style="display:flex;gap:16px;align-items:center;margin-bottom:12px;">
            <img id="avatarPreview" src="<%= (user.avatar && user.avatar.startsWith('/')) ? user.avatar : (user.avatar ? '/uploads/' + user.avatar : '/images/profile-placeholder.svg') %>" alt="avatar" style="width:72px;height:72px;border-radius:50%;object-fit:cover;box-shadow:0 4px 12px rgba(0,0,0,0.15);" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22150%22 height=%22150%22 viewBox=%220 0 150 150%22%3E%3Crect width=%22150%22 height=%22150%22 fill=%22%23f0f0f0%22/%3E%3Ccircle cx=%2275%22 cy=%2260%22 r=%2225%22 fill=%22%23ddd%22/%3E%3Cpath d=%22M30 130 Q30 100 50 100 L100 100 Q120 100 120 130 Z%22 fill=%22%23ddd%22/%3E%3C/svg%3E'" />
            <div class="muted">‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div>
          </div>
          <div class="field">
            <label>‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
            <input name="full_name" value="<%= user.full_name %>" />
          </div>
          <div class="field">
            <label>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</label>
            <input type="file" name="avatar" accept="image/*" onchange="previewAvatar(event)" />
          </div>
          <div class="field">
            <label>username</label>
            <input name="username" value="<%= user.username %>" />
          </div>
          <div class="field">
            <label>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
            <input name="location" value="<%= user.location %>" />
          </div>
          <div style="display:flex;gap:8px">
            <button class="btn btn-primary" type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            <a class="btn btn-ghost" href="/user">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</a>
          </div>
        </form>
      </div>
    </main>

  <%- include('partials/footer_unified') %>
  <%- include('partials/report_footer') %>
  <script>
    function previewAvatar(e){
      const file = e && e.target && e.target.files && e.target.files[0];
      if (!file) return;
      const url = URL.createObjectURL(file);
      const img = document.getElementById('avatarPreview');
      if (img) img.src = url;
    }
  </script>
  </body>
</html>